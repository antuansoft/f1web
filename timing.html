<!DOCTYPE html>
<html>
 
    <head lang="es">
        <meta charset="UTF-8">
        <title>Timing</title>
        <meta name="Formula uno" content="Formula uno simulaciÃ³n">
        <link rel="stylesheet" type="text/css" href="style.css" />
        <script src="js/json.js"></script>
        <script>
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            var gp
            var driversDictionary = { };
            var laps = []
            var lap

            function readGp(text){
                 var data = JSON.parse(text); //parse JSON
                 console.log(data);
                 document.getElementById("gp").innerHTML += data.gp
            }
            function readDrivers(text){
                 var data = JSON.parse(text); //parse JSON
                 //console.log(data);
                 var driversArray = data.drivers;

                 for (var i = 0; i < driversArray.length; ++i) {
                    var entry = driversArray[i];

                    driversDictionary[entry.number] = entry;
                    console.log(driversDictionary[entry.number])
                 }
                                  
            }

            function readLapChart(text){
                 laps = JSON.parse(text); //parse JSON
                 console.log(laps);
                 for (lapindex in laps){
                    for (carindex in laps[lapindex])
                        console.log(laps[lapindex][carindex])
                 }

            }            

            function readLapTime(text){
                 laps = JSON.parse(text); //parse JSON
                 console.log(laps);
                 for (lapindex in laps){
                    for (timeindex in laps[lapindex])
                        console.log(laps[lapindex][timeindex])
                 }

            }   

            function buildData(){

            }
            window.onload = function(){
                gp=urlParams.get('gp')
                loadGps = new Promise((resolve, reject) => {
                    readTextFile("2022/data/gpinfo_"+gp+".json", readGp)
                    resolve('loadGps fired!');
                })
                loadDrivers = new Promise((resolve, reject) => {
                    readTextFile("2022/data/drivers_"+gp+".json", readDrivers)
                    resolve('loadDrivers fired!');
                })
                loadLapchart = new Promise((resolve, reject) => {
                    readTextFile("2022/data/lapchart_"+gp+".json", readLapChart)
                    resolve('loadLapchart fired!');
                })
                loadLaptimes = new Promise((resolve, reject) => {
                    readTextFile("2022/data/laptime_"+gp+".json", readLapTime)
                    resolve('loadLaptimes fired!');
                })
                asyncFunctions=[loadGps,loadDrivers,loadLapchart,loadLaptimes]

                Promise.all(asyncFunctions).then((resp) => {
                    console.log(resp);
                    buildData();
                }).catch((err) => {
                    console.log('something unexpected happened:'+ err);
                })
                
                //
                //
                //
                //buildData()
            }
        </script>    
    </head>

    <body background="background/xxxx.jpg" class="imagen_background">
        <div w3-include-html="header.html"></div>
        <div class="migas">
            <ul>
                <li><a href="index.html">Portada</a></li>
            </ul>
        </div>
        <p class="titulo3">ANTUAN F1 Lab by lap timing</p>

        <p class="titulo2" id="gp"></p>
        <div>
            <table id="laps" border="1">

            </table>
        </div>
        
        <div w3-include-html="footer.html"></div>        
    </body>

</html>